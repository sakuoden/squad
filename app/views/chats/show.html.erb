<!-- チーム詳細画面全体の箱 -->
<div class="teams_show_box">

	<!-- チーム詳細の左の箱 -->
	<div class="teams_show_left_box clearfix">

		<!-- チーム詳細の左の箱の画像の位置 -->
		<div class="teams_show_left_box_image_position">
			<%= attachment_image_tag @team, :team_image, :fill, 300, 300, fallback: "/images/no_image.jpg", class: "teams_show_box_row1_image" %>
		</div>
		<!-- チーム詳細左の箱の画像の位置fin -->

		<!-- チーム詳細の左側の箱のチーム名 -->
		<div class="teams_show_left_box_team_name">
			<%= @team.team_name %>
		</div>
		<!-- チーム詳細の左側の箱のチーム名fin -->


		<!-- チーム詳細画面のの左側のボタンの行 -->
		<div class="teams_show_left_box_btn_row">

			<%= link_to "/teams/#{@team.id}", class:"teams_show_left_box_btn_row_link" do %>
				<div class="teams_show_left_box_btn teams_show_left_box_btn_active">投稿</div>
			<% end %>

			<%= link_to "/teams/#{@team.id}/member", class:"teams_show_left_box_btn_row_link" do %>
				<div class="teams_show_left_box_btn">メンバー</div>
			<% end %>

			<%= link_to "/chats/#{@team.id}", class:"teams_show_left_box_btn_row_link" do %>
				<div class="teams_show_left_box_btn">トーク</div>
			<% end %>

		</div>
		<!-- チーム詳細画面のの左側のボタンの行fin -->


	</div>
	<!-- チーム詳細の左の箱fin -->




	<!-- pjaxで入れ替える全体の箱 -->
	<main id="barba-wrapper">
	<div class="barba-container">

		<%= form_for @chat do |f| %>
		<!-- チーム詳細画面の右側の箱 -->
		<div class="teams_show_box_right_chat_box">

			<div class="teams_show_box_right_chat_smallbox">

				<!-- チーム詳細画面の右側のノートアイコンのある行 -->
				<div class="teams_show_box_right_chat_smallbox_note_row">
					<%= link_to "/", class:"teams_show_box_right_chat_small_box_note_link" do %>
						<i class="fas fa-book-open tems_show_box_right_chat_small_box_icon"></i>
					<% end %>
				</div>
				<!-- チーム詳細画面の右側のノートアイコンのある行fin -->

				<!-- チーム詳細画面の右側のトーク内容が入る箱 -->
				<div class="teams_show_box_right_chat_smallbox_chat_screen">
					<% @team.chats.each do |chat| %>

						<div class="teams_show_box_right_chat_smallbox_chat_row">

							<%= attachment_image_tag chat.user, :image, :fill, 50, 50, fallback: "no_image.jpg", class: "teams_show_box_right_chat_smallbox_image" %>

							<div class="teams_show_box_right_chat_smallbox_chat_ballon">
								<%= chat.chat_comment %>
							</div>

						</div>

					<% end %>
				</div>
				<!-- チーム詳細画面の右側のトーク内容が入る箱fin -->

				<div class="teams_show_box_right_chat_smallbox_border"></div>

				<div class="teams_show_box_right_chat_smallbox_chat_form_position">
					<%= f.text_area :chat_comment, class:"teams_show_box_right_chat_smallbox_chat_form" %>
				</div>

				<div class="teams_show_box_right_chat_smallbox_chat_form_row">
					<%= f.hidden_field :team, :value => @team.id %>
					<%= button_tag type:"submit", class:"teams_show_box_right_chat_btn" do %>
						<i class="fab fa-telegram-plane"></i>
					<% end %>
				</div>



			</div>

		</div>
		<!-- チーム詳細画面の右側の箱fin -->
		<% end %>


	</div>
	</main>
	<!-- pjaxで入れ替える全体の箱fin -->



<!-- チーム詳細画面全体の箱fin -->
</div>


<% if @team.members.where(user_id: current_user.id).exists? %>
	<!-- チーム詳細画面の画像投稿ボタン -->
	<%= link_to new_post_path(team_id: @team.id), class:"teams_show_new_post_btn_link" do %>
		<div class="teams_show_new_post_btn">
			<i class="fas fa-camera"></i>
			<p>投稿</p>
		</div>
	<% end %>
	<!-- チーム詳細画面の投稿ボタンfin -->
<% end %>






<script>
	$(document).ready(function(){

		Barba.Pjax.start();

	var FadeTransition = Barba.BaseTransition.extend({
 		start: function() {

	    Promise
    	 .all([this.newContainerLoading, this.fadeOut()])
     	 .then(this.fadeIn.bind(this));
  		},

	fadeOut: function() {
    	return $(this.oldContainer).animate({ opacity: 0 }).promise();
  	},

	fadeIn: function() {

    	var _this = this;
    	var $el = $(this.newContainer);

	    $(this.oldContainer).hide();

		$el.css({
	  		visibility : 'visible',
	  		opacity : 0
		});

	    $el.animate({ opacity: 1 }, 400, function() {
	      _this.done();
	    });

		  }

		});

	Barba.Pjax.getTransition = function() {
  		return FadeTransition;
	};

	$('.teams_show_left_box_btn').removeClass('teams_show_left_box_btn_active');
	$('.teams_show_left_box_btn').eq(2).addClass('teams_show_left_box_btn_active')

	$('.teams_show_left_box_btn').click(function(){

		$('.teams_show_left_box_btn').removeClass('teams_show_left_box_btn_active');
		$(this).addClass('teams_show_left_box_btn_active');

	});

// https://qiita.com/yuki-n/items/885f6f059167a7b5aedcを参考にしたリアルタイムチャット機能。時間が無いので断念。
	// 	function(){
	// 		function buildCHAT(chat) {
	// var chat = $('tbody').append('<tr class="chats" data-id=' + chat.id + '><td>' + chat.text + '</td><td><a href="/messages/' + message.id + '">Show</a></td><td><a href="/messages/' + message.id +'/edit">Edit</a></td><td><a data-confirm="Are you sure?" rel="nofollow" data-method="delete" href="/messages/' + message.id + '">Destroy</a></td>');
 //  }
	// 		}


	// 	$(function(){
	// 		setInterval(update, 10000);
	// 	});

	// 	function update(){
	// 		var chat_id = $('.chats:last').data('id')

	// 		console.log(chat_id);

	// 		$.ajax({
	// 			url: location.href,
	// 			type: 'GET',
	// 			data: {
	// 				chat: {id: chat_id}
	// 			},
	// 			dataType: 'json'
	// 		})

	// 	.always(function(data){
	// 		$.each(data, function(i,data){
	// 			buildCHAT(data);
	// 		});
	// 	});

	// 	}

	});



</script>







